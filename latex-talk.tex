\XeTeXgenerateactualtext=1
\documentclass[fontset=none]{ctexbeamer}
% \documentclass[aspectratio=169]{ctexbeamer}

\usepackage{graphicx,array,caption,listings,ragged2e,fontawesome,unicode-math,hologo,bookmark}

\makeatletter

\@namedef{ver@beamerfontthememetropolis.sty}{9999/99/99}

% Beamer theme
\usetheme{Xiaoshan}
\usefonttheme{serif}

% Beamer settings
% \metroset{sectionpage=simple}
\metroset{progressbar=none}
\setbeamerfont{title}{size=\huge, series=\bfseries}
\setbeamerfont*{subtitle}{size=\large, shape=\itshape}
\setbeamerfont{section title}{size=\Large, series=\bfseries}
\setbeamerfont{frametitle}{size=\large, series=\bfseries}
\setbeamerfont{caption}{size=\footnotesize, series=\bfseries}
\setbeamerfont{footnote}{size=\tiny}
\setbeamerfont{alerted text}{series=\bfseries}
\addtobeamertemplate{institute}{\raggedleft}{}
\setbeamertemplate{title}{%
  \raggedleft
  \linespread{1.0}%
  \inserttitle
  \hspace*{1.2cm}\par
  \vspace*{0.5em}}
\setbeamertemplate{subtitle}{%
  \raggedleft
  \insertsubtitle
  \hspace*{1.2cm}\par
  \vspace*{0.5em}}
\setbeamertemplate{title page}{
  \begin{minipage}[b]{\textwidth}
    \mbox{}\vfill
    \usebeamertemplate*{title}
    \usebeamertemplate*{subtitle}
    \usebeamertemplate*{title separator}
    \usebeamertemplate*{author}
    \usebeamertemplate*{date}
    \usebeamertemplate*{institute}
    \vfill
  \end{minipage}}
\setbeamertemplate{frame numbering}{\zhnumber[style=Financial]{\insertframenumber}}
\setbeamertemplate{itemize/enumerate subbody begin}{\footnotesize}

% CTeX settings
% \ctexset{punct=kaiming}

% Colors
\colorlet{keyword}{松花绿}
\colorlet{comment}{漆黑!50}
\colorlet{texcs}{酡红}
\colorlet{emph1}{靛蓝}
\colorlet{emph2}{乌金}
\colorlet{inline}{玄色}

% Fonts
\setmainfont{Libertinus Serif}[Scale=1.1, BoldFont=* Bold]
\setsansfont{Roboto}
\setmonofont{Iosevka}
\setmathfont{Libertinus Math}
\setCJKmainfont{Source Han Serif SC}[%
  UprightFont=* SemiBold, BoldFont=* Heavy, ItalicFont=* SemiBold, RawFeature=+fwid]
\setCJKmonofont{Sarasa Mono SC}

% Graphics
\captionsetup[figure]{labelformat=empty, justification=centering}

% PDF bookmark
\apptocmd{\beamer@@frametitle}{%
  \only<1>{\expandafter\ifnum\insertcontinuationcount<2\relax
    \bookmark[page=\the\c@page,level=4]{#1}\fi}}{}{}

% Code listings
\lstdefinestyle{style@latex}{
  language        = [latex]TeX,
  alsoletter      = {*},
  basewidth       = 0.54em,
  escapeinside    = {(*}{*)},
  basicstyle      = \small\ttfamily,
  keywordstyle    = \bfseries\color{keyword},
  commentstyle    = \itshape\color{comment},
  texcsstyle      = *\color{texcs},
  emphstyle       = [1]\itshape\color{emph1},
  emphstyle       = [2]\color{emph2},
  numbersep       = 4pt,
}
\lstnewenvironment{texcode}[1][]{\lstset{%
  style=style@latex,
  gobble=2,
  morekeywords={\documentclass,\usepackage,\begin,\end},#1}}{}
\lstMakeShortInline[%
  basicstyle=\ttfamily\color{inline}, keepspaces=true, escapeinside={(*}{*)}]|

% Hack
% Use small caps for LaTeX symbol
\DeclareRobustCommand{\LaTeX}{%
  L\kern-.3em%
  \raisebox{.2em}{\textsc{a}}\kern-.14em%
  \TeX}
% PoZheHao, see https://github.com/CTeX-org/ctex-kit/issues/382
\ExplSyntaxOn
\xeCJK_new_class:n { PoZheHao }
\__xeCJK_save_CJK_class:n { PoZheHao }
\xeCJK_declare_char_class:nn { PoZheHao } { "2014 }
\seq_map_inline:Nn \g__xeCJK_class_seq
  {
    \str_if_eq:nnF {#1} { PoZheHao }
      {
        \xeCJK_copy_inter_class_toks:nnnn { PoZheHao } {#1} { FullRight } {#1}
        \xeCJK_copy_inter_class_toks:nnnn {#1} { PoZheHao } {#1} { FullRight }
      }
  }
\ExplSyntaxOff

% Macros
\newcommand\link[1]{\href{#1}{\faLink}}
\newcommand\CASE[1]{{\addfontfeatures{Letters=Uppercase}#1}}
\newcommand\zhparen[1]{（\raisebox{0.2ex}{#1}）}
\newcommand\enparen[1]{\CASE{(}#1\CASE{)}}
\newcommand\exe[1]{\texttt{#1}}
\newcommand\pkg[1]{\texttt{#1}}
\newcommand\usv[1]{\texttt{U+#1}}
\newcommand\kbd[1]{{\fontspec{Libertinus Keyboard}#1}}
\newcommand\kbdWin{{\fontspec{Libertinus Keyboard}\symbol{"E168}}}
\newcommand\kbdAlt{{\fontspec{Libertinus Keyboard}\symbol{"E171}}}
\newcommand\kbdCtrl{{\fontspec{Libertinus Keyboard}\symbol{"E173}}}
\newcommand\kbdShift{{\fontspec{Libertinus Keyboard}\symbol{"E174}}}
\newcommand\kbdIns{{\fontspec{Libertinus Keyboard}\symbol{"E18B}}}

\newcommand\XeTeX{\hologo{XeTeX}}
\newcommand\pdfTeX{\hologo{pdfTeX}}
\newcommand\LuaTeX{\hologo{LuaTeX}}

\makeatother

% Information
\title{现代 \LaTeX{} 入门讲座}
\subtitle{Introduction to Modern \LaTeX{}}
\author{曾祥东}
\institute{复旦大学\quad 物理系}
\date{2018 年 12 月}

\begin{document}

\maketitle

\begin{frame}[standout]
  \large\fontspec{xkcd-script.ttf}[Path=./fonts/, Ligatures=TeX]
  ``Your paper makes no goddamn sense, \\
  but it's the most beautiful thing \\
  \XeTeXglyph\XeTeXglyphindex"I_hyphen_p_r_o_n_o_u_n"\relax\
  have ever laid eyes on.''
\end{frame}

\input{include/introduction.tex}
\input{include/install.tex}
\input{include/start.tex}
\input{include/content.tex}
\input{include/math.tex}
\input{include/typography.tex}
\input{include/advanced.tex}

\begin{frame}[standout]
  \huge \textbf{谢谢大家！}
\end{frame}

\end{document}
